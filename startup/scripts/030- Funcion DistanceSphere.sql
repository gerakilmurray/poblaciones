DROP FUNCTION IF EXISTS `DistanceSphere`;

DELIMITER //
CREATE FUNCTION `DistanceSphere`(`pt1` POINT, `pt2` POINT) RETURNS
	DOUBLE
	NO SQL
	DETERMINISTIC
	SQL SECURITY INVOKER
BEGIN
	RETURN 12742000 * ASIN(SQRT(
			POWER(SIN((ST_Y(pt2) - ST_Y(pt1)) * 0.0087266472), 2)
			+ COS(ST_Y(pt1) * 0.0174532944) * COS(ST_Y(pt2)
			* 0.0174532944) * POWER(
			SIN((ST_X(pt2) - ST_X(pt1)) * 0.0087266472), 2)));
END//
DELIMITER ;

UPDATE version SET ver_value = '030' WHERE ver_name = 'DB';

